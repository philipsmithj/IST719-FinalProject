{
    "contents" : "\nEnsurePackage<-function(x){\n  x<-as.character(x)\n  if(!require(x,character.only=TRUE)){\n    install.packages(pkgs=x,\n                       repos=\"http://cran.r-project.org\")\n    require(x,character.only=TRUE)\n  }\n}\n\n#Install and Load Packages\nEnsurePackage(\"ggplot2\")\nEnsurePackage(\"reshape2\")\nEnsurePackage(\"plyr\")\nEnsurePackage(\"maps\")\nEnsurePackage(\"mapproj\")\nEnsurePackage(\"shiny\")\nEnsurePackage(\"shinyapps\")\n\nlibrary(shinyapps)\nlibrary(ggplot2)\nlibrary(reshape2)\nlibrary(plyr)\nlibrary(maps)\nlibrary(mapproj)\nlibrary(shiny)\n\n###---Functions---###\n\n#State Full Name\nstateFullNames<-function(df){\n  stateFull<-vector()\n  for (i in 1:length(df$State)){\n    if(is.na(state.name[match(df$State[i],state.abb)])){break}\n    stateFull[i]<-state.name[match(df$State[i],state.abb)]}\n  df$StateFullName<-stateFull\n  return(df)}\n\n#Fit Categories with Descriptions\ncatDescript<-function(df){\n  desc<-vector()\n  for (i in 1:length(df$Category)){\n    desc[i]<-as.character(code$Description[match(df$Category[i], code$Item.Code)])}\n  df$Description<-desc\n  return(df)}\n\n#Add DOL info for year\ndol<-function(){\n  u<-vector()\n  for (i in 1:length(taxes$Year)){\n    u<-Unemp$Rate[match(taxes$Year, Unemp$Year)]}\n  taxes$Unemployment<-u\n  return(taxes)}\n\n###No longer used## - Add Population Estimates for 2013, stateFullNames()needs to run prior\npopEst<-function(df){\n  pop<-vector()\n  for (i in 1:length(df$StateFullName)){}\n  df$PopEst<-pop\n  return(df)}\n\n# Melt and name the raw data\nmold<-function(tax,year){\n  #Melt into proper format\n  taxes<-melt(tax, rm.na=TRUE)\n  #Rename col headers\n  colnames(taxes)=c(\"Category\", \"State\", \"Revenue\")\n  #Add State's Full Names\n  taxes<-stateFullNames(taxes)\n  taxes$Year<-year\n  return(taxes)}\n\n\n#Define plot based on user input\nuserPlot<-function(theseStates, yearRange, cats) {\n  v<-taxes\n  v<-subset(v, !is.na(match(v$StateFullName,theseStates)))\n  v<-subset(v, Year<=max(yearRange))\n  v<-subset(v, Year>=min(yearRange))\n  v<-subset(v, !is.na(match(v$Description,cats)))\n  ptype<-ggplot(v)+\n    geom_tile(aes(as.factor(Year),State, fill=Revenue/Population),color=\"lightgray\")+\n    coord_polar(theta='y')+\n    facet_grid(.~Description)+\n    scale_fill_gradient(low=\"khaki\",high=\"darkred\")+\n    labs(fill=\"Revenue per person in $1K\", x=\"Year (each ring)\", title=\"Revenue per person (Revenue/Population) by selected State and Category\")+\n    theme(axis.text=element_text(color=\"black\"))\n  return(ptype)}\n\nnatlComPlot<-function(yearRange, cats){\n  u<-subset(taxes, !is.na(match(taxes$Description,cats)))\n  u<-subset(u, (min(yearRange)<=Year)&(Year<=max(yearRange)))\n  pl<-qplot(as.factor(Year),Revenue/Population,data=u,color=Description,\n            geom=\"smooth\",group=Description,\n            main=\"National Totals for selection\",\n            xlab=\"Year\",\n            ylab=\"Revenue per person in $1K\")+\n    labs(color=\"Tax Category\")\n  return(pl)}\n\npopMap<-function(aYear){\n  states<-map_data(\"state\")\n  ttaxes<-taxes\n  colnames(ttaxes)[1]<-\"region\"\n  ttaxes$region<-tolower(ttaxes$region)\n  aPop<-subset(ttaxes, Year==aYear)\n  aPop<-subset(aPop, Category==\"T01\")\n  myMap<-merge(states,aPop, by=\"region\")\n  myMap<-myMap[order(myMap$order),]\n  #thisPl<-qplot(long, lat, data=myMap, group=group, fill=Population, geom=\"polygon\", xlab=\"\",ylab=\"\")\n  thisPl<-ggplot(myMap, aes(x=long, y=lat, fill=Population/1000000, group=group))+geom_polygon()\n  thisPl<-thisPl+scale_fill_gradient2(midpoint=(mean(myMap$Population)/1000000)+4,\n                                      low=\"white\",\n                                      mid=\"darkblue\",\n                                      high=\"red\",\n                                      labels=comma,\n                                      name=\"Population in millions\")\n  thiPl<-thisPl+coord_map()\n  thisPl<-thisPl+coord_fixed()\n  thisPl<-thisPl+labs(title=\"Lower 48 population for selected year\")\n  thisPl<-thisPl+theme(axis.text=element_text(color=\"white\"),\n                       axis.title=element_text(color=\"white\"),\n                       axis.ticks=element_line(color=\"white\"),\n                       panel.background=element_rect(fill=\"steelblue\"))\n  return(thisPl)}\n\nstacked<-function(aYear,wPop,cats){\n  d<-subset(taxes, Year==aYear)\n  c<-vector()\n  for (i in 1:length(d$Description)){\n   c[i]<-cats[match(d$Description[i],cats)]}\n  d$disp<-c\n  if(wPop){\n    g<-ggplot(d, aes(StateFullName,Revenue/Population))+\n      labs(y=\"Revenue per person in $1 thousands\")}\n  if(!wPop){\n    g<-ggplot(d, aes(StateFullName,Revenue/1000))+\n      labs(y=\"Revenue in $1 millions\")}\n  stack<-g+geom_bar(stat=\"identity\", aes(fill=disp,position=\"stack\"))+\n    x90+\n    labs(fill=\"Tax Category\",x=\"State\",title=\"Selective category highlight of States' annual revenue\")+\n    scale_y_continuous(labels=comma)+\n    theme(panel.grid.major=element_line(size=0.5,color=\"lightgray\"),\n          axis.ticks=element_line(color=\"white\"))\n  return(stack)}\n\n###---Execution---###\n\n#Get Data\ncode<-read.csv(file=\"codes.csv\", sep=\",\")\nt14<-read.csv(file=\"14staxcd.csv\", sep=\",\")\nt13<-read.csv(file=\"13staxcd.csv\", sep=\",\")\nt12<-read.csv(file=\"12staxcd.csv\", sep=\",\")\nt11<-read.csv(file=\"11staxcd.csv\", sep=\",\")\nt10<-read.csv(file=\"10staxcd.csv\", sep=\",\")\nt09<-read.csv(file=\"09staxcd.csv\", sep=\",\")\nt08<-read.csv(file=\"08staxcd.csv\", sep=\",\")\nt07<-read.csv(file=\"07staxcd.csv\", sep=\",\")\nt06<-read.csv(file=\"06staxcd.csv\", sep=\",\")\nt05<-read.csv(file=\"05staxcd.csv\", sep=\",\")\np<-read.csv(file=\"pop.csv\", sep=\",\")\ncolnames(p)<-c(\"StateFullName\",1999:2014)\np<-melt(p,rm.na=TRUE, measure.vars = as.character(1999:2014))\ncolnames(p)<-c(\"StateFullName\", \"Year\", \"Population\")\n\n#Figures from Department of Labor, mean annual unemployment estimates\nYear<-c(2005:2014)\nRate<-c(5.083,4.608,4.616,5.8,9.28,9.608,8.94,8.06, 7.366,6.15)\nUnemp<-data.frame(Year, Rate)\n\nt14<-mold(t14,2014)\nt13<-mold(t13,2013)\nt12<-mold(t12,2012)\nt11<-mold(t11,2011)\nt10<-mold(t10,2010)\nt09<-mold(t09,2009)\nt08<-mold(t08,2008)\nt07<-mold(t07,2007)\nt06<-mold(t06,2006)\nt05<-mold(t05,2005)\n\ntaxes<-merge(t14,t13, all=TRUE)\ntaxes<-merge(taxes, t12, all=TRUE)\ntaxes<-merge(taxes, t11, all=TRUE)\ntaxes<-merge(taxes, t10, all=TRUE)\ntaxes<-merge(taxes, t09, all=TRUE)\ntaxes<-merge(taxes, t08, all=TRUE)\ntaxes<-merge(taxes, t07, all=TRUE)\ntaxes<-merge(taxes, t06, all=TRUE)\ntaxes<-merge(taxes, t05, all=TRUE)\ntaxes<-catDescript(taxes)\ntaxes<-merge(p,taxes, all=TRUE)\ntaxes$Year<-as.integer(as.numeric_version(taxes$Year))\ntaxes<-subset(taxes, Year>=2005)\ntaxes$StateFullName<-as.character(taxes$StateFullName)\ntaxes<-dol()\ntaxes$Unemployment<-taxes$Unemployment/100\ntaxes<-subset(taxes, !(is.na(taxes$Description)))\n\n#Some smaller sets within \nincome<-subset(taxes, Description==\"Individual Income Taxes\")\n\n#Text for About page\nt<-\"Ten Years of State Taxes 2005 - 2014\"\n\n## Dress-up##\n# X axis text 90deg\nx90<-theme(axis.text.x=element_text(angle=90))\n# Thousands seperator, no scientific\ncomma<-function(x) format(x,scientific=FALSE,big.mark = \",\")\n\nnarr<-h5(\"There are only a few things you can be sure of in life. \n         As the saying goes, there's death, then there's taxes. \n         For this project, I wanted to conduct a national comparison between states' taxes. \n         While we're all under the same set of rules for federal taxes, there are \n         differences in each state that might make it worthwhile to weigh these differences \n         when choosing a state to focus on while job hunting. \n         First, I would like you to look at the overview section to get a feel for \n         what is going on at a national scale over the last ten years. \n         Notice the steady increase? \n         Can you find the recession? \n         Has the nation bounced back? \n         I encourage you to use the comparison tool to explore the data to come to your own conclusions and perhaps form your own hypothesis. \")\n\naud1<-h4(\"Audiences for this project are:\")\naud2<-h5(\"1. American Public so that they can be informed on what their state is collecting and how.\")\naud3<-h5(\"2. Public Administrators\")\naud4<-h5(\"3. Expanding or relocating companies and organizations\")\naud5<-h5(\"4. Anyone estimating the cost of living (like a grad student looking for a job and a place to put down roots)\")\n\nq1<-h4(\"Questions to be answered:\")\nq2<-h5(\"1. What is the highest earner for a state?\")\nq3<-h5(\"2. What is the revenue per person for a state or group of states and how do they compare to one another?\")\nq4<-h5(\"3. What happened during the recession ~2008?\")\nq5<-h5(\"4. How do tax rates compare over the years? Are we paying more?\")\nq6<-h5(\"5. Are there any indicators for economic health such as increased revenue from sales tax?\")\n\nmyName<-h4(\"Compiled and processed by Philip J. smith\")\n\ns<-h3(\"Sources\")\ns1<-h5(\"Tax data sourced from the Unitied States Census Bureau: \n      http://www.census.gov/govs/statetax/\")\ns2<-h5(\"Population data sourced from the Unitied States Census Bureau: \n       http://www.census.gov/popest/data/historical/index.html\")\ns3<-h5(\"Unemployment data sourced from the Unitied States Department of Labor: \n       http://data.bls.gov/pdq/SurveyOutputServlet\")\n\nn1<-h3(\"Notes\")\nn2<-h5(\"All 'Revenue' values are in $1K [or $1 * 1000]\") \n\n#Static Plots\n\noverviewPlot<-qplot(StateFullName,Description,data=taxes,geom=\"point\",size=Revenue/1000000,color=Population,\n                    main=\"Total Revenue by Category by State (Totaled from 2005 to 2014)\",\n                    xlab=\"State\",\n                    ylab=\"Tax Category\") +x90\noverviewPlot<-overviewPlot+scale_color_gradient(low=\"darkblue\", high=\"red\", labels=comma)+\n  scale_size(labels=comma, name=\"Decade's Revenue in $1 billion\")\n\n\noverTime<-qplot(as.factor(Year),Revenue/1000,data=taxes,group=1,geom=\"smooth\", method=\"gam\", formula=y~s(x,bs=\"cs\"),\n                main=\"Raw Revenue Growth (all states) from 2005 to 2014 (mean centered, +/- 1 standard deviation)\",\n                xlab=\"Year\",\n                ylab=\"Total Revenue in $1 million\")+\n  scale_y_continuous(labels=comma)+\n  annotate(\"text\", x=5.25,y=625,label=\"Continued growth despite narrowing deviations\")\n\n##Start Building Application\n#Est Shiny objects\nshinyUI(navbarPage(title=\"Ten Years of State Taxes 2005 - 2014\",\n                   tabPanel(title=\"About\",h2(t),narr,\n                            aud1,aud2,aud3,aud4,aud5,div(),div(),\n                            q1,q2,q3,q4,q5,q6,div(),div(),\n                            #n1,n2,div(),\n                            s,s1,s2,s3,div(),div(),\n                            myName),\n                   tabPanel(\"Overview\",\n                            h5(\"These plots are used to find our high and low earners. \n                               In the following graphs you can explore why.\"),\n                            plotOutput(\"overPlot\"),\n                            plotOutput(\"timePlot\")),\n                   tabPanel(\"Population's Affect\",\n                            sidebarLayout(sidebarPanel(\n                              sliderInput(\"sYear\", \"Population Year\", min(taxes$Year),max(taxes$Year),\n                                          value=2014, step=1),\n                              checkboxInput(\"withPop\", \"Factor in Population (Revenue/Population)\"),\n                              checkboxGroupInput(\"checkGroup\", \"Categories\", unique(taxes$Description),\n                                                 selected=unique(taxes$Description)[1])),\n                              mainPanel(h4(\"Use these to tailor categories that apply to your situation.\"),\n                                        h5(\"--Fullscreen is recommended--\"),\n                                plotOutput(\"popPlot\"),\n                                plotOutput(\"stackPlot\")))),\n                   tabPanel(\"Comparison\",\n                            sidebarLayout(\n                              sidebarPanel(\n                                sliderInput(\"year\",\"Year\",min(taxes$Year),max(taxes$Year),value=c(2008,2011),step=1),\n                                selectInput(\"states\", \"States (select at least one)\",taxes$StateFullName,multiple = TRUE,selected=\"Alabama\"),\n                                checkboxGroupInput(\"catGroup\", \"Categories (select at least one, up to 6)\", unique(taxes$Description),selected=unique(taxes$Description)[1])\n                              ),\n                              mainPanel(h3(\"Comparison\"),\n                                        h5(\"Recommend this be viewed at full screen\"),\n                                        plotOutput(\"thisPlot\"),\n                                        plotOutput(\"natPlot\")\n                                        \n                              )\n                            )\n                   )\n)\n)",
    "created" : 1439674953579.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "768008628",
    "id" : "B6202114",
    "lastKnownWriteTime" : 1439688141,
    "path" : "~/Syracuse/IST719 - Info Visualization/Final Project Programming/Final R processing/ui.R",
    "project_path" : "ui.R",
    "properties" : {
        "notebook_format" : "html_document",
        "tempName" : "Untitled1"
    },
    "relative_order" : 1,
    "source_on_save" : false,
    "type" : "r_source"
}